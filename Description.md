# 課題

下記ケースのときにどういった対処が取れるか？に関して自由に記述してください。（文章ベースでも図ベースでも問題ありません。）

特に正解不正解はなく、どういった行動を意思決定するのかを知るための課題です。

複数の BE アプリケーションを本番環境で運用する場合、どのようなことを気にしながらどんな PF（クラウドや PaaS、IaaS、CaaS 等）を利用してサービスを開始しますか？

実際によく利用するものやこういうのを利用したいんだよなと思ったりするものを、自由形式で記述いただきたいです。

GitHub での運用やデプロイメントパイプライン文脈（CI/CD）や監視・セキュリティ文脈の視点も取り入れて記述いただくとなおありがたいです。

# 回答

GCP は経験があまりない（VM とか Bigquery くらい）ので、AWS と Azure で回答します。

本番環境で気にする点は大きく下記 6 点です。

これを考慮したときに状況や仕様にもよりますが、一般的な本番環境の第一選択は AWS で ECS Fargate を使った添付図のような構成です。
複数サービスを ALB でふりわけます。
Fargate を選ぶ理由として、上記の 6 点を考慮すると、以下のようになります。

- 環境構築、運用の容易さ
  - イメージを push してデプロイするだけなので構築が容易
  - CaaS は開発を docker 環境で行っていれば基本的に環境による動作不良が起きない（絶対ないわけではないですが）
  - Github Actions での CI/CD の設定もあまり複雑でないし、AWS 公式の actions がちゃんと動く
- セキュリティ
  - Fargate に限らないが、基本的に閉じた系（プライベートサブネット）に環境を作って、外部への露出は最低限にする
  - ALB に WAF の設定（AWS WAF や AWS Shield）の追加する（これも簡単に行える）
- ## 監視
- スケーリング
- アベイラビリティ
- コスト

- 環境構築が容易
- CaaS は開発を docker 環境で行っていれば基本的に環境による動作不良が起きない（絶対ないわけではないですが）
- Github Actions での CI/CD の設定もあまり複雑でないし、公式の actions がちゃんと動く
- Auto スケーリング設定が容易
- ALB に WAF 設定が簡単

運用する BE アプリが 3 つくらいまでなら ECS Fargate で、それ以上になると Kubernetes 使った方がコスト的には優位になるのかなと思います。

仕様によっては Lambda 等使ったサーバーレスアーキテクチャを考えます。
単純な CRUD であれば API gateway とか App sync 使えばほぼほぼ実装なしで運用可能なので。

マネージドサービスを使うと環境構築手順が単純であるため、不具合が起きたときの再現、対処がしやすいです。
一方で、完全な原因究明や、細かいログ等をとれないというデメリットはあるものの、Fargate ではコンテナの中に直接入る方法があったり、
基本的なログ（CPU 使用率とかメモリ使用率とか標準出力）は CloudWatch で見れる上、sidecar で監視用のプロセスを追加しておけばもっと細かいログも取れるので、
大抵の仕様には対応できるとため、マネージドサービスの使用が
